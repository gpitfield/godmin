<!DOCTYPE html>
<html>
<head>
<!-- Standard Meta -->
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

{{template "admin/bootstrap.html"}}

<!-- Site Properities -->
<title>{{.brand}}</title>

</head>
  <body>

    <div class="container">
    {{ template "admin/navbar.html" .}}
    {{ $values := .results}}
    {{ $modelAdmin := .modelAdmin}}
      <ol class="breadcrumb">
        <li><a href="/admin">Home</a></li>
        <li class="active">{{.modelAdmin.ModelName}}</li>
      </ol>

      <div>
        <form id="record-set" method="post">
          <div style="display:inline-block;margin-bottom:10px;">
            {{if $modelAdmin.ListActions}}
              <select class="form-control" name="action">
              <option value="">Actions</option>
            {{else}}
              <select class="form-control" disabled>
              <option value="">No Actions Defined</option>
            {{end}}
              {{range $action := $modelAdmin.ListActions}}
                <option value="{{$action.Identifier}}">{{$action.DisplayName}}</option>
              {{end}}
            </select>
          </div>
          {{if $modelAdmin.ListActions}}
            <button type="submit" id="go-button" class="btn btn-default">Go</button>
          {{else}}
            <button type="submit" class="btn btn-default" disabled="disabled">Go</button>
          {{end}}
          <a href="add" class="btn btn-default">New</a>
          <table class="table table-striped well" id="list-table">
            <th>
              <input type="checkbox" id="selectAll">
            </th>
            {{range $key, $val := .modelAdmin.ListFields}}
              <th>{{$key}}</th>
            {{end}}
            {{template "admin/tableWidgets.html" .}}
          </table>
        </form>
      </div>
    <nav>
      {{ template "admin/paginator.html" .}}
    </nav>
    {{range $modelAdmin.ListActions}}
      {{if .Confirm}}
        {{ template "admin/confirmModal.html" .}}
      {{end}}
    {{end}}
    </div> <!-- /container -->

    <script type="text/javascript">
      var checkedIDs = [];
      function updateCheckedIds () {
        checkedIDs = []        
        $("#list-table").find("input:checked").each(function(index){
          if ($(this).hasClass("rowCheck")) {
            checkedIDs.push($(this).attr("id"));
          }
        });
      }
      function doConfirm (action) {
        var actionID = "#" + action + "-confirm";
        if ($(actionID)) {

          $(actionID).modal('show');
        } else {
          $("#record-set").submit();
        }
      }

      function confirmAction(event) {
        $("#record-set").submit();
      }

      $(document).ready(function(){
        $("#selectAll").change(function(){
          if ($(this).is(":checked")) {
            $(":checkbox").prop("checked", true);
          } else {
            $(":checkbox").prop("checked", false);
          }
          updateCheckedIds();
        });

        $("#go-button").click(function(event){
          var action = $("select.form-control").val();
          event.preventDefault();
          doConfirm(action);
        });

        $(".rowCheck").change(function(){
          if (! $(this).is(":checked")) {
            $("#selectAll").prop("checked", false);            
          }
          updateCheckedIds();
        });

        $(".modal-confirm").click(function(event){
          confirmAction(event);
        });


      });
    </script>

  </body>
  </html>